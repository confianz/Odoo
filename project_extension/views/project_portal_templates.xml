<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <data noupdate="0">
        <template id='proposal_portal_user_template' name='Project Proposal Portal User Template' inherit_id='portal.portal_sidebar' primary='True'>
            <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
                
                <t t-set="head">
                    <script type="text/javascript" src="/project_extension/static/lib/print.min.js"></script>
                    <script type="text/javascript">
                        function js_print_pdf(){
                            var pdf = document.getElementById("print_pdf_attach");
                            printJS(pdf.dataset.url);
                        };
                        function js_print_image(){
                            var image = document.getElementById("print_image_attach");
                            printJS("data:image/jpeg;base64,"+image.dataset.datas, 'image');
                        };
                    </script>
                </t>
                <div class="row mt16 o_portal_sale_sidebar">
                <!-- Sidebar -->
                <t t-call="portal.portal_record_sidebar">
                    <t t-set="classes" t-value="'col-12 col-lg flex-lg-grow-0 d-print-none'"/>

<!--                    <t t-set="title">-->
<!--                        <h2 class="mb-0"><b t-field="sale_order.amount_total"/> </h2>-->
<!--                    </t>-->
                    <t t-set="entries">
                        <ul class="list-group list-group-flush flex-wrap flex-row flex-lg-column">
                            <li class="list-group-item flex-grow-1">
                                <a t-if='not proposal_version.check_if_already_done_by_user(user_id)' role="button" class="btn btn-primary btn-block mb8" data-toggle="modal" data-target="#modalaccept" href="#">
                                    <i class="fa fa-check"/> Accept
                                </a>
                                <div class="o_download_pdf btn-toolbar flex-sm-nowrap">
                                    <div class="btn-group flex-grow-1 mr-1 mb-1" >
                                        <a class="btn btn-secondary btn-block o_download_btn" t-att-href="proposal_version.get_attachment_url(download=True)" title="Download"><i class="fa fa-download"/> Download</a>
                                    </div>
                                    <div class="btn-group flex-grow-1 mb-1" >
                                        <a t-if="proposal_version.check_attachment_mimetype() == 'image'" onclick="js_print_image()" class="btn btn-secondary btn-block o_print_btn o_portal_invoice_print" id="print_image_attach" title="Print" target="_blank" t-att-data-datas="proposal_version.get_attachment_datas()"><i class="fa fa-print"/> Print</a>
                                        <a t-if="proposal_version.check_attachment_mimetype() == 'pdf'" class="btn btn-secondary btn-block o_print_btn o_portal_invoice_print" onclick="js_print_pdf()" id="print_pdf_attach" title="Print" target="_blank" t-att-data-url="proposal_version.get_attachment_url()"><i class="fa fa-print"/> Print</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </t>
                </t>
                <div id="quote_content" class="col-12 col-lg justify-content-end">
                    <div class="row justify-content-center text-center d-print-none pt-1 pb-4">
                        <div role="dialog" class="modal fade" id="modalaccept">
                            <div class="modal-dialog">
                                <form id="accept" method="POST" t-att-data-order-id="proposal_version.id" t-attf-action="/proposal/version/#{proposal_version.id}/accept" class="js_accept_json modal-content js_website_submit_form">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <header class="modal-header">
                                        <h4 class="modal-title">Approve Proposal</h4>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                                    </header>
                                    <main class="modal-body" id="sign-dialog">
                                        <p>
                                            <span>Upon Approving this proposal, it will be send to the customer in the next step.</span>
                                                <br/><span>Proposal Approved by:</span> <b t-field="user_id.partner_id"/>
                                        </p>
                                        <textarea rows="4" name="accept_message" placeholder="Your feedback..." class="form-control" />
                                    </main>
                                    <footer class="modal-footer">
                                        <button type="submit" t-att-id="proposal_version.id" class="btn btn-primary"><i class="fa fa-check"></i> Approve</button>
                                        <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                                    </footer>
                                </form>
                            </div>
                        </div>
                        <div role="dialog" class="modal fade" id="modaldecline">
                            <div class="modal-dialog">
                                <form id="decline" method="POST" t-attf-action="/proposal/version/#{proposal_version.id}/decline" class="modal-content">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <header class="modal-header">
                                        <h4 class="modal-title">Reject This Proposal</h4>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                                    </header>
                                    <main class="modal-body">
                                        <p>
                                            Please include reason for rejecting this proposal, this will help to draft a better proposal.
                                        </p>
                                        <textarea rows="4" name="decline_message" required="" placeholder="Your feedback..." class="form-control" />
                                    </main>
                                    <footer class="modal-footer">
                                        <button type="submit" t-att-id="proposal_version.id" class="btn btn-danger"><i class="fa fa-times"></i> Reject</button>
                                        <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                                    </footer>
                                </form>
                            </div>
                        </div>
                        <div class="alert  alert-dismissible fade show" role="alert">
                          If unable to view PDF, please change the browser settings to "View PDF in Browser". Mobile devices not supported.
                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span>&amp;times;</span>
                          </button>
                        </div>
                            <img t-if="proposal_version.check_attachment_mimetype() == 'image'" t-att-src="proposal_version.get_attachment_url()" width="800px" height="800px"/>
                            <embed t-elif="proposal_version.check_attachment_mimetype() == 'pdf'" t-att-src="proposal_version.get_attachment_url()" width="800px" height="800px" type="application/pdf" class="o_field_pdfviewer o_pdfview_iframe"/>
                        <t>
                            <div class="col-sm-auto mt8">
                                <a t-if='not proposal_version.check_if_already_done_by_user(user_id)' role="button" class="btn btn-primary" data-toggle="modal" data-target="#modalaccept" href="#"><i class="fa fa-check"/> Accept</a>
                            </div>
                            <div class="col-sm-auto mt8">
                                <a role="button" class="btn btn-secondary" href="#discussion"><i class="fa fa-comment"/> Feedback</a>
                            </div>
                            <div class="col-sm-auto mt8">
                                <a t-if='not proposal_version.check_if_already_done_by_user(user_id)' role="button" class="btn btn-danger" data-toggle="modal" data-target="#modaldecline" href="#"> <i class="fa fa-times"/> Reject</a>
                            </div>
                        </t>
                        </div>
                        <div id="project_communication" class="mt-4">
                                <h2>Communication</h2>
                                <t t-call="portal.message_thread">
                                    <t t-set="object" t-value="proposal_version"/>
                                </t>
                        </div>
                    </div>
                </div>
            </xpath>
        </template>
        
        
        <template id='proposal_portal_customer_template' name='Project Proposal Portal Customer Template' inherit_id='portal.portal_sidebar' primary='True'>
            <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
                <t t-set="head">
                    <script type="text/javascript" src="/project_extension/static/lib/print.min.js"></script>
                    <script type="text/javascript">
                        function js_print_pdf(){
                            var pdf = document.getElementById("print_pdf_attach");
                            printJS(pdf.dataset.url);
                        };
                        function js_print_image(){
                            var image = document.getElementById("print_image_attach");
                            printJS("data:image/jpeg;base64,"+image.dataset.datas, 'image');
                        };
                    </script>
                </t>
                <div class="row mt16 o_portal_sale_sidebar">
                <!-- Sidebar -->
                <t t-call="portal.portal_record_sidebar">
                    <t t-set="classes" t-value="'col-12 col-lg flex-lg-grow-0 d-print-none'"/>

<!--                    <t t-set="title">-->
<!--                        <h2 class="mb-0"><b t-field="sale_order.amount_total"/> </h2>-->
<!--                    </t>-->
                    <t t-set="entries">
                        <ul class="list-group list-group-flush flex-wrap flex-row flex-lg-column">
                            <li class="list-group-item flex-grow-1">
                                <a t-if='not proposal_version.check_if_already_done_by_customer()' role="button" class="btn btn-primary btn-block mb8" data-toggle="modal" data-target="#modalaccept" href="#">
                                    <i class="fa fa-check"/> Accept
                                </a>
                                <t t-log="proposal_version"/>
                                <div class="o_download_pdf btn-toolbar flex-sm-nowrap">
                                    <div class="btn-group flex-grow-1 mr-1 mb-1" >
                                        <a class="btn btn-secondary btn-block o_download_btn" t-att-href="proposal_version.get_attachment_url(download=True)" title="Download"><i class="fa fa-download"/> Download</a>
                                    </div>
                                    <div class="btn-group flex-grow-1 mb-1" >
                                        <a t-if="proposal_version.check_attachment_mimetype() == 'image'" onclick="js_print_image()" class="btn btn-secondary btn-block o_print_btn o_portal_invoice_print" id="print_image_attach" title="Print" target="_blank" t-att-data-datas="proposal_version.get_attachment_datas()"><i class="fa fa-print"/> Print</a>
                                        <a t-if="proposal_version.check_attachment_mimetype() == 'pdf'" class="btn btn-secondary btn-block o_print_btn o_portal_invoice_print" onclick="js_print_pdf()" id="print_pdf_attach" title="Print" target="_blank" t-att-data-url="proposal_version.get_attachment_url()"><i class="fa fa-print"/> Print</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </t>
                </t>
                <div id="quote_content" class="col-12 col-lg justify-content-end">
                    <div class="row justify-content-center text-center d-print-none pt-1 pb-4">
                        <div role="dialog" class="modal fade" id="modalaccept">
                            <div class="modal-dialog">
                                <form id="accept" method="POST" t-att-data-order-id="proposal_version.id" t-attf-action="/project/proposal/#{proposal_version.id}/accept" class="js_accept_json modal-content js_website_submit_form">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <header class="modal-header">
                                        <h4 class="modal-title">Accept Proposal</h4>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                                    </header>
                                    <main class="modal-body" id="sign-dialog">
                                        <p>
                                                <span>Upon Accepting this proposal, MNDA will be sent to you, for signature, in the next step.</span>
                                                <br/><span>Proposal Accepted by:</span> <b t-field="proposal_version.project_id.partner_id"/>
                                        </p>
                                        <textarea rows="4" name="accept_message" placeholder="Your feedback..." class="form-control" />
                                    </main>
                                    <footer class="modal-footer">
                                        <button type="submit" t-att-id="proposal_version.id" class="btn btn-primary"><i class="fa fa-check"></i> Accept</button>
                                        <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                                    </footer>
                                </form>
                            </div>
                        </div>
                        <div role="dialog" class="modal fade" id="modaldecline">
                            <div class="modal-dialog">
                                <form id="decline" method="POST" t-attf-action="/project/proposal/#{proposal_version.id}/decline" class="modal-content">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <header class="modal-header">
                                        <h4 class="modal-title">Reject This Proposal</h4>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                                    </header>
                                    <main class="modal-body">
                                        <p>
                                            Please include reason for rejecting this proposal, this will help to draft a better proposal.
                                        </p>
                                        <textarea rows="4" name="decline_message" required="" placeholder="Your feedback..." class="form-control" />
                                    </main>
                                    <footer class="modal-footer">
                                        <button type="submit" t-att-id="proposal_version.id" class="btn btn-danger"><i class="fa fa-times"></i> Reject</button>
                                        <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                                    </footer>
                                </form>
                            </div>
                        </div>
<!--                        <div class="alert alert-warning alert-dismissible fade show" role="alert">-->
<!--                          If unable to view PDF, please change the browser settings to "View PDF in Browser". Mobile devices not supported.-->
<!--                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">-->
<!--                            <span>&amp;times;</span>-->
<!--                          </button>-->
<!--                        </div>-->
                            <img t-if="proposal_version.check_attachment_mimetype() == 'image'" t-att-src="proposal_version.get_attachment_url()" width="800px" height="800px"/>
                            <embed t-elif="proposal_version.check_attachment_mimetype() == 'pdf'" t-att-src="proposal_version.get_attachment_url()" width="800px" height="800px" type="application/pdf" class="o_field_pdfviewer o_pdfview_iframe"/>
                        <t>
                            <div class="col-sm-auto mt8">
                                <a t-if='not proposal_version.check_if_already_done_by_customer()' role="button" class="btn btn-primary" data-toggle="modal" data-target="#modalaccept" href="#"><i class="fa fa-check"/> Accept</a>
                            </div>
                            <div class="col-sm-auto mt8">
                                <a role="button" class="btn btn-secondary" href="#discussion"><i class="fa fa-comment"/> Feedback</a>
                            </div>
                            <div class="col-sm-auto mt8">
                                <a t-if='not proposal_version.check_if_already_done_by_customer()' role="button" class="btn btn-danger" data-toggle="modal" data-target="#modaldecline" href="#"> <i class="fa fa-times"/> Reject</a>
                            </div>
                        </t>
                        </div>
<!--                        <div id="project_communication" class="mt-4">-->
<!--                                <h2>Communication</h2>-->
<!--                                <t t-call="portal.message_thread">-->
<!--                                    <t t-set="object" t-value="proposal_version"/>-->
<!--                                    <t t-set="token" t-value="token"/>-->
<!--                                    <t t-set="pid" t-value="partner_id"/>-->
<!--                                    <t t-set="allow_composer" t-value="1"/>-->
<!--                                    <t t-set="display_composer" t-value="token"/>-->
<!--                                    <t t-set="domain" t-value="[('message_ids.body', 'ilike', self)]"/>-->
<!--                                </t>-->
<!--                        </div>-->
                    </div>
                </div>
            </xpath>
            
        </template>
        
    </data>
</odoo>
















